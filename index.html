<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNICODA</title>
    
    <!-- Noto Ecosystem Import -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wght@300;400;700&family=Noto+Sans+Symbols:wght@400;700&family=Noto+Sans+Symbols+2&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/style.css">
</head>    
<body>
    <!-- BLOCKING SETUP SCRIPT: PREVENTS FLASHES -->
    <script>
        (function() {
            // 1. Instant Theme
            const base = localStorage.getItem('unicoda_base_theme') || 'default';
            const mode = localStorage.getItem('unicoda_theme_mode') || 'dark';
            let attr = null;
            if (base === 'default') {
                if (mode === 'light') attr = 'light';
            } else {
                if (mode === 'light') attr = `${base}-light`;
                else attr = base;
            }
            if (attr) document.documentElement.setAttribute('data-theme', attr);

            // 2. Instant Backdrop Opacity
            // Must match the logic in main.js
            const levels = [0.4, 0.2, 0.1, 0.05, 0];
            const bgIndex = parseInt(localStorage.getItem('unicoda_bg_index') || '2');
            const opacity = levels[bgIndex] !== undefined ? levels[bgIndex] : 0.1;
            
            // Write style directly to element to bypass CSS transition on load
            const bgEl = document.getElementById('ascii-backdrop');
            if (bgEl) bgEl.style.opacity = opacity;
        })();
    </script>
        <!-- Icon Definitions for Annotations (Hidden) -->
    <svg id="sa-icon-definitions" style="display: none;">
        <symbol id="sa-icon-close" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></symbol>
        <symbol id="sa-icon-minimize" viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"></line></symbol>
        <symbol id="sa-icon-maximize" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></symbol>
        <symbol id="sa-icon-copy" viewBox="0 0 24 24"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></symbol>
    </svg>

    <!-- ASCII Background Layer -->
    <pre id="ascii-backdrop"></pre>

    <!-- Post-it Notes Layer -->
    <div id="notes-layer"></div>

    <!-- Custom Tooltip -->
    <div id="global-tooltip" class="hidden"></div>

    <!-- Main Application Layer -->
    <main id="app">
        
        <!-- GLOBAL UI: Top Left (Filters) -->
        <div class="ui-corner top-left">
            <div class="filters">
                <!-- Core Types -->
                <button class="filter-btn active" data-type="barcode" data-tooltip="Barcodes">≣</button>
                <button class="filter-btn active" data-type="current" data-tooltip="Currents">ጸ</button>
                <button class="filter-btn active" data-type="geode" data-tooltip="Geodes">❖</button>
                <span class="separator">|</span>
                <!-- Special Modes -->
                <button class="filter-btn active" data-type="journey" data-tooltip="Journeys">⛓</button>
                <span class="separator">|</span>
                <!-- AI Filter -->
                <button class="filter-btn active" data-type="ai" data-tooltip="AI Generated">⎔</button>
            </div>
        </div>

        <!-- GLOBAL UI: Top Right (Menus & Note) -->
        <div class="ui-corner top-right" style="display: flex; gap: 1rem; align-items: center;">
             <button id="btn-add-note" class="icon-btn" data-tooltip="Add Note">+</button>
             <span class="separator">|</span>
             <button id="btn-lists" class="icon-btn" data-tooltip="Lists">☰</button>
             <button id="btn-settings" class="icon-btn" data-tooltip="Settings">⚙</button>
        </div>

    <!-- Title Screen (Default: Hidden to prevent flash if Skip Title is ON) -->
        <section id="title-screen" class="hidden">
            <h1 id="main-title" class="project-title">
                <span>U</span><span>N</span><span>I</span><span>C</span><span>O</span><span>D</span><span>A</span>
            </h1>
            <div class="menu-options">
                <button id="btn-start" class="text-btn">START</button>
                <button id="btn-about" class="text-btn">ABOUT</button>
            </div>
        </section>

        <!-- About Overlay -->
        <div id="about-overlay" class="overlay hidden">
            <div class="overlay-content">
                <p>Constraint-based symbolic languages.</p>
                <p>Currents. Geodes. Barcodes.</p>
                <p>No translation. No explanation.</p>
                <button id="btn-close-about" class="text-btn" style="margin-top: 2rem;">CLOSE</button>
            </div>
        </div>

        <!-- Introduction Sequence -->
        <section id="intro-sequence" class="hidden">
            <div id="intro-content">
                <!-- Content injected by JS -->
            </div>
            <div class="intro-controls">
                <button id="btn-skip-intro" class="text-btn">SKIP</button>
                <button id="btn-next-intro" class="text-btn">NEXT</button>
            </div>
        </section>

        <!-- Loading Screen -->
        <section id="loading-screen" class="hidden">
            <pre id="loader-display"></pre>
        </section>

        <!-- Main Reading Area -->
        <section id="reader" class="hidden">
            <!-- Composition Display -->
            <div id="composition-wrapper">
                <div id="composition-anchor">
                    <pre id="composition-display"></pre>
                    <div id="title-container">
                        <div id="composition-title"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- GLOBAL UI: Unified Bottom Footer -->
        <footer id="reader-footer">
            <!-- Left Tools -->
            <div class="footer-left">
                <button id="toggle-theme" class="icon-btn" data-tooltip="Theme">◑</button>
                <button id="btn-backdrop" class="icon-btn" data-tooltip="Backdrop Density">▓</button>
                <span class="separator">|</span>
                <button id="nav-fav" class="icon-btn" data-tooltip="Favorite">☆</button>
            </div>
            
            <!-- Center Navigation (Hidden on Title Screen via CSS) -->
            <div class="footer-center">
                <!-- AI Indicator (Symmetric to Skip) -->
                <div id="ai-indicator" class="status-indicator icon-btn" data-tooltip="AI Generated">⎔</div>
                
                <button id="nav-back" class="nav-btn icon-btn" data-tooltip="Back">←</button>
                <!-- Random Button -->
                <button id="nav-random" class="nav-btn icon-btn" data-tooltip="Random">⚄</button>
                <button id="nav-forward" class="nav-btn icon-btn" data-tooltip="Next">→</button>
                
                <button id="nav-skip" class="nav-btn icon-btn" data-tooltip="Skip Journey">↠</button>
            </div>

            <!-- Right Side (Version Info) -->
            <div class="footer-right">
                <div class="version-info">v.1.6</div>
            </div>
        </footer>

        <!-- Settings Menu -->
        <div id="settings-menu" class="overlay hidden">
            <div class="overlay-content settings-list">
                
                <div class="setting-row">
                    <span>TEXT SIZE</span>
                    <!-- 8 Steps (1 to 8) -->
                    <input type="range" id="slider-text-size" min="1" max="8" step="1" value="4">
                </div>

                <div class="setting-row note-size-row">
                    <span>NOTE SIZE</span>
                    <!-- 1=Small, 2=Medium, 3=Big -->
                    <input type="range" id="slider-note-size" min="1" max="3" step="1" value="2">
                </div>

                <div class="setting-row">
                    <span>TITLES</span>
                    <button id="toggle-titles" class="text-btn">ON</button>
                </div>

                <div class="setting-row">
                    <span>EXPLICIT</span>
                    <button id="toggle-explicit" class="text-btn">OFF</button>
                </div>

                <div class="setting-row">
                    <span>SKIP TITLE SCREEN</span>
                    <button id="toggle-skip-title" class="text-btn">OFF</button>
                </div>

                <div class="setting-row">
                    <span>INTRO</span>
                    <button id="btn-reset-intro" class="text-btn">RESET</button>
                </div>
                <div class="setting-row">
                     <span>DATA</span>
                    <button id="btn-clear-data" class="text-btn danger">CLEAR ALL</button>
                </div>
                <button id="btn-close-settings" class="text-btn" style="margin-top: 2rem;">CLOSE</button>
            </div>
        </div>
        
        <!-- List Overlay -->
        <div id="list-menu" class="overlay hidden">
             <div class="overlay-content" style="width: 500px;">
                <div class="list-tabs">
                    <button id="tab-visited" class="text-btn active">VISITED</button>
                    <button id="tab-favorites" class="text-btn">FAVORITES</button>
                </div>
                <div id="list-container" class="scroll-list"></div>
                <button id="btn-close-lists" class="text-btn" style="margin-top: 2rem;">CLOSE</button>
             </div>
        </div>

    </main>

    <!-- Scripts -->
    <script src="js/backdrop.js"></script>
    <script src="js/data.js"></script>
    <script src="js/annotations.js"></script>
    <script src="js/main.js"></script>
</body>
</html> 